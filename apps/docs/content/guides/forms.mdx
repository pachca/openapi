---
title: Формы
description: Представления с набором полей для пользователей
---

# Формы

Формы в Пачке позволяют вам отображать пользователям представления с указанным вами набором полей. Представления отображаются в виде модального окна, а результат заполнения формы вы можетет получить на свой сервер.

На текущий момент вызов модального окна с представлением возможен только через кнопки в сообщении бота.

## Модальное окно

Модальное окно состоит из стандартных элементов - заголовка, кнопки закрытия (отмены), набора полей (подзаголовки, текст, ввод текста, выбор, списки и тд.) и кнопки отправки.

<Image src="/images/forms/modal-window.png" alt="Модальное окно" maxWidth={420} />

## Жизненный цикл модального окна

Всё начинается с нажатия пользователем `Data-кнопки` кнопки в сообщении.

- В результате нажатия кнопки вашему приложению отправляется исходящий вебхук с уникальным `trigger_id`;
- Затем приложение фомирует представление и отправляет его, а пользователю отображается модальное окно;
- Далее пользователь заполняет поля и вашему приложению отправляется исходящий вебхук с данными заполненных пользователем полей в представлении;
- В ответе на вебхук ваше приложение может отправить список ошибок, которые необходимо отобразить пользателю в представлении, или ответить кодом 200 (после чего модальное окно будет закрыто).

## Блоки представления

Блоки - это компоненты представления, которые позволяют вам формировать необходимые поля ввода данных и отображать дополнительную пояснительную информацию. Они указываются в поле `view.blocks` при открытии представления. Вы можете добавить до **100 блоков** в одно представление.

### Заголовок (header)

<Image src="/images/forms/header.png" alt="Заголовок" />

<SchemaBlock name="ViewBlockHeader" />

### Обычный текст (plain_text)

<Image src="/images/forms/plaintext.png" alt="Обычный текст" />

<SchemaBlock name="ViewBlockPlainText" />

### Форматированный текст (markdown)

<Image src="/images/forms/markdown.png" alt="Форматированный текст" />

<SchemaBlock name="ViewBlockMarkdown" />

В поле `text` вам необходимо прислать форматированный текст в синтаксисе `markdown`. Поддерживаются конструкции, указанные в таблице ниже.

<MarkdownSyntaxTable />

### Разделитель (divider)

<Image src="/images/forms/divider.png" alt="Разделитель" />

<SchemaBlock name="ViewBlockDivider" />

### Текстовое поле (input)

<Image src="/images/forms/input.png" alt="Текстовое поле" />

<SchemaBlock name="ViewBlockInput" />

### Выпадающий список (select)

<Image src="/images/forms/select.png" alt="Выпадающий список" />

<SchemaBlock name="ViewBlockSelect" />

### Радиокнопки (radio)

<Image src="/images/forms/radio.png" alt="Радиокнопки" />

<SchemaBlock name="ViewBlockRadio" />

### Чекбоксы (checkbox)

<Image src="/images/forms/checkbox.png" alt="Чекбоксы" />

<SchemaBlock name="ViewBlockCheckbox" />

### Выбор даты (date)

<Image src="/images/forms/date.png" alt="Выбор даты" />

<SchemaBlock name="ViewBlockDate" />

### Выбор времени (time)

<Image src="/images/forms/time.png" alt="Выбор времени" />

<SchemaBlock name="ViewBlockTime" />

### Загрузка файлов (file_input)

<Image src="/images/forms/file.png" alt="Загрузка файлов" />

<SchemaBlock name="ViewBlockFileInput" />

## Открытие представления

Чтобы открыть модальное окно с представлением, ваше приложение должно иметь действительный, неистекший `trigger_id`. Это требование связано с тем, чтобы приложение открывало модальное окно только с разрешения пользователя и делало это быстро.

Для открытия представления используйте метод [Открытие представления](POST /views/open).

<Warning>
  С целью поддержания интерактивности и отзывчивости интерфейсов Пачки, срок жизни `trigger_id`
  ограничен и составляет **3 секунды**
</Warning>

## Получение результатов

После заполнения пользователей полей в представлении и отправки их, в ваше приложение отправляется исходящий вебхук. Вебхук будет отправлен на `Webhook URL`, который вы указали в настройках бота во вкладке «Исходящий Webhook», от имени которого было отправлено сообщение с кнопкой (нажатие на которую и вызвало открытие представления).

Задача вашего приложения - обработать входяший вебхук в короткое время и дать ответ. Это может быть как успех и команда на закрытие представления пользователю в интерфейсе Пачки, так и набор ошибок, которые необходио отобразить пользователю в представлении.

Ваше приложение должно дать ответ на вебхук в течение **3 секунд**. В ином случае, пользователь получит ошибку отправки в интерфейсе Пачки. Все значения полей будут сохранены и **пользователь повторит попытку отправки формы**. О том, как закрыть представление или отобразить ошибки по конкретным полям, вы можете прочитать в разделе [Закрытие и отображение ошибок](#закрытие-и-отображение-ошибок).

Вебхук содержит информацию, которая была заложена при открытии представления пользователю (такие поля, как `private_metadata` и `callback_id`), и данные заполненных полей представления.

Каждый исходящий вебхук защищён с помощью подписи, основанной на хешировании содержимого. Подробнее об этом, а также о других методах проверки подлинности исходящего вебхука, вы можете прочитать в блоке Безопасность.

<SchemaBlock
  name="ViewSubmitWebhookPayload"
  title="Структура исходящего вебхука о заполнении формы"
/>

<CodeBlock language="json" title="Пример вебхука о заполнении формы">
{`{
    "type": "view",
    "event": "submit",
    "private_metadata": "{'timeoff_id':4378}",
    "callback_id": "timeoff_reguest_form",
    "user_id": 1235523,
    "data": {
        "date_start": "2025-07-01",
        "date_end": "2025-07-14",
        "request_doc": [
            {
                "name": "request.png",
                "size": 19153,
                "url": "<url>"
            }
        ],
        "accessibility": "phone_only",
        "info": "Поеду в сибирь на свадьбу лучшего друга",
        "newsletters": ["new_tasks", "project_updates"],
        "team": "success",
        "time": "22:00"
    },
    "webhook_timestamp": 1755075544
}`}
</CodeBlock>

<Warning>Срок жизни прямых ссылкок на скачивание файлов ограничен и составляет **1 час**</Warning>

## Закрытие и отображение ошибок

После заполнения пользователем полей в представлении в приложение будет отправлен исходящий вебхук. В этот момент вы можете сохранить полученные значения или провести валидацию правильности заполнения полей и отправить пользователю ошибки.

Вам необходимо оперативно ответить на вебхук (кодом `200` или `400` со списком ошибок). В ином случае, пользователь получит ошибку отправки в интерфейсе Пачки. Все значения полей будут сохранены и **пользователь повторит попытку отправки формы**.

<Warning>
  С целью поддержания интерактивности и отзывчивости интерфейсов Пачки, время на ответ ограничего.
  Ваше приложение должно дать ответ на вебхук в течение **3 секунд**.
</Warning>

### Закрытие представления

Если вы хотите просто закрыть пользователю представление (нет необходимости отображать ошибки), то ответ должен быть `HTTP 200 OK`. Никакое тело ответа не требуется.

<CodeBlock language="http" title="Пример ответа на вебхук для закрытия представления">
{`HTTP/1.1 200 OK
Server: nginx/1.14.2
Date: Wed, 22 Apr 2025 12:32:29 GMT
Content-Type: text/plain; charset=utf-8`}
</CodeBlock>

### Отображение ошибок

Если вы хотите отобразить пользователю ошибки заполнения конкретных полей представления, то ответ должен быть `HTTP 400 Bad Request`, а тело ответа содержать массив полей с указанием текста ошибки.

<SchemaBlock
  name="ViewErrorsResponse"
  title="Тело ответа с указанием текста ошибки для каждого поля"
/>

<CodeBlock language="http" title="Пример ответа на вебхук для отображения ошибок">
{`HTTP/1.1 400 Bad Request
Server: nginx/1.14.2
Date: Wed, 22 Apr 2025 12:32:29 GMT
Content-Type: application/json; charset=utf-8
Transfer-Encoding: chunked
Connection: close
ETag: W/"4d63aae1430a3bbd35e95e3db6b364df"
Cache-Control: max-age=0, private, must-revalidate
X-Request-Id: 12f8a05c-c5cf-4a79-8d2f-f82cc477c410
X-Runtime: 0.117503
Vary: Origin
X-Rack-CORS: miss; no-origin

{"errors":{"date_end":"Дата окончания отпуска не может быть меньше даты начала","request_doc":"В заявлении не найдена электронная подпись"}}`}

</CodeBlock>

<Image src="/images/forms/errors.png" alt="Пример отображения ошибок в интерфейсе представления" />
