---
title: Формы
description: Представления с набором полей для пользователей
---

# Формы

Формы в Пачке позволяют вам отображать пользователям представления с указанным вами набором полей. Представления отображаются в виде модального окна, а результат заполнения формы вы можетет получить на свой сервер.

<Info>На текущий момент вызов модального окна с представлением возможен только через кнопки в сообщении бота.</Info>

## Модальное окно

Модальное окно состоит из стандартных элементов - заголовка, кнопки закрытия (отмены), набора полей (подзаголовки, текст, ввод текста, выбор, списки и тд.) и кнопки отправки.

<ImageCard src="/images/forms/modal-window.png" alt="Модальное окно" caption="Модальное окно" maxWidth={420} />

## Жизненный цикл модального окна

Всё начинается с нажатия пользователем `Data-кнопки` кнопки в сообщении.

- В результате нажатия кнопки вашему приложению отправляется исходящий вебхук с уникальным `trigger_id`;
- Затем [приложение формирует представление и отправляет его](#открытие-представления), а пользователю отображается модальное окно;
- Далее пользователь [заполняет поля](#блоки-представления) и [вашему приложению отправляется исходящий вебхук](#получение-результатов) с данными заполненных пользователем полей в представлении;
- В ответе на вебхук ваше приложение может [отправить список ошибок](#отображение-ошибок), которые необходимо отобразить пользователю в представлении, или ответить кодом 200 (после чего модальное окно будет [закрыто](#закрытие-представления)).

<Mermaid
  title="Жизненный цикл модального окна"
  chart={`sequenceDiagram
    participant User as Пользователь
    participant Pachca as Пачка
    participant Bot as Ваше приложение

    Note over User: Нажатие Data-кнопки
    User->>Pachca: Клик по кнопке
    Pachca->>Bot: Webhook (button click)<br/>+ trigger_id
    Note right of Bot: trigger_id действителен<br/>в течение 3 секунд
    Note over Bot: Формирование<br/>представления
    Bot->>Pachca: POST /views/open<br/>+ trigger_id + view
    Pachca->>User: Открытие модального окна

    Note over User: Заполнение полей
    User->>Pachca: Отправка формы
    Pachca->>Bot: Webhook (view_submission)<br/>+ данные полей
    Note right of Bot: Ответ должен быть дан<br/>в течение 3 секунд

    alt Данные валидны
        Bot->>Pachca: HTTP 200 OK
        Pachca->>User: Закрытие модального окна
    else Есть ошибки валидации
        Bot->>Pachca: HTTP 400 Bad Request<br/>+ список ошибок
        Pachca->>User: Отображение ошибок
        Note over User: Исправление<br/>и повторная отправка
    end`}
/>

## Блоки представления

Блоки - это компоненты представления, которые позволяют вам формировать необходимые поля ввода данных и отображать дополнительную пояснительную информацию. Они указываются в поле `view.blocks` при открытии представления. Вы можете добавить до **100 блоков** в одно представление.

### Заголовок (header)

<ImageCard src="/images/forms/header.png" alt="Заголовок" caption="Заголовок" maxWidth={810} />

<SchemaBlock name="ViewBlockHeader" />

### Обычный текст (plain_text)

<ImageCard src="/images/forms/plaintext.png" alt="Обычный текст" caption="Обычный текст" maxWidth={810} />

<SchemaBlock name="ViewBlockPlainText" />

### Форматированный текст (markdown)

<ImageCard src="/images/forms/markdown.png" alt="Форматированный текст" caption="Форматированный текст" maxWidth={810} />

<SchemaBlock name="ViewBlockMarkdown" />

В поле `text` вам необходимо прислать форматированный текст в синтаксисе `markdown`. Поддерживаются конструкции, указанные в таблице ниже.

| Элемент | Синтаксис | Результат |
|---------|-----------|-----------|
| Жирный | `**это жирный текст**` или `__это жирный текст__` | **это жирный текст** |
| Курсив | `*это курсивный текст*` или `_это курсивный текст_` | *это курсивный текст* |
| Ссылки | `[текст ссылки](https://www.google.com)` | [текст ссылки](https://www.google.com) |
| Маркированный список | `- первый пункт`<br/>`- второй пункт` | • первый пункт<br/>• второй пункт |
| Нумерованный список | `1. первый пункт`<br/>`2. второй пункт` | 1. первый пункт<br/>2. второй пункт |
| Зачеркнутый | `~~это зачеркнутый текст~~` | ~~это зачеркнутый текст~~ |
| Строчный код | `` `код в тексте` `` | `код в тексте` |
| Блок кода | `` ``` ``<br/>Блок кода<br/>`` ``` `` | `Блок кода` |

### Разделитель (divider)

<ImageCard src="/images/forms/divider.png" alt="Разделитель" caption="Разделитель" maxWidth={810} />

<SchemaBlock name="ViewBlockDivider" />

### Текстовое поле (input)

<ImageCard src="/images/forms/input.png" alt="Текстовое поле" caption="Текстовое поле" maxWidth={810} />

<SchemaBlock name="ViewBlockInput" />

### Выпадающий список (select)

<ImageCard src="/images/forms/select.png" alt="Выпадающий список" caption="Выпадающий список" maxWidth={810} />

<SchemaBlock name="ViewBlockSelect" />

### Радиокнопки (radio)

<ImageCard src="/images/forms/radio.png" alt="Радиокнопки" caption="Радиокнопки" maxWidth={810} />

<SchemaBlock name="ViewBlockRadio" />

### Чекбоксы (checkbox)

<ImageCard src="/images/forms/checkbox.png" alt="Чекбоксы" caption="Чекбоксы" maxWidth={810} />

<SchemaBlock name="ViewBlockCheckbox" />

### Выбор даты (date)

<ImageCard src="/images/forms/date.png" alt="Выбор даты" caption="Выбор даты" maxWidth={810} />

<SchemaBlock name="ViewBlockDate" />

### Выбор времени (time)

<ImageCard src="/images/forms/time.png" alt="Выбор времени" caption="Выбор времени" maxWidth={810} />

<SchemaBlock name="ViewBlockTime" />

### Загрузка файлов (file_input)

<ImageCard src="/images/forms/file.png" alt="Загрузка файлов" caption="Загрузка файлов" maxWidth={810} />

<SchemaBlock name="ViewBlockFileInput" />

## Открытие представления

Чтобы открыть модальное окно с представлением, ваше приложение должно иметь действительный, неистекший `trigger_id`. Это требование связано с тем, чтобы приложение открывало модальное окно только с разрешения пользователя и делало это быстро.

Для открытия представления используйте метод [Открытие представления](POST /views/open).

<Danger>
  С целью поддержания интерактивности и отзывчивости интерфейсов Пачки, срок жизни `trigger_id`
  ограничен и составляет **3 секунды**
</Danger>

## Получение результатов

После заполнения пользователей полей в представлении и отправки их, в ваше приложение отправляется исходящий вебхук. Вебхук будет отправлен на `Webhook URL`, который вы указали в настройках бота во вкладке «Исходящий Webhook», от имени которого было отправлено сообщение с кнопкой (нажатие на которую и вызвало открытие представления).

Задача вашего приложения - обработать входяший вебхук в короткое время и дать ответ. Это может быть как успех и команда на закрытие представления пользователю в интерфейсе Пачки, так и набор ошибок, которые необходио отобразить пользователю в представлении.

Ваше приложение должно дать ответ на вебхук в течение **3 секунд**. В ином случае, пользователь получит ошибку отправки в интерфейсе Пачки. Все значения полей будут сохранены и **пользователь повторит попытку отправки формы**. О том, как закрыть представление или отобразить ошибки по конкретным полям, вы можете прочитать в разделе [Закрытие и отображение ошибок](#закрытие-и-отображение-ошибок).

Вебхук содержит информацию, которая была заложена при открытии представления пользователю (такие поля, как `private_metadata` и `callback_id`), и данные заполненных полей представления.

Каждый исходящий вебхук защищён с помощью подписи, основанной на хешировании содержимого. Подробнее об этом, а также о других методах проверки подлинности исходящего вебхука, вы можете прочитать в блоке Безопасность.

<SchemaBlock
  name="ViewSubmitWebhookPayload"
  title="Структура исходящего вебхука о заполнении формы"
/>

<CodeBlock language="json" title="Пример вебхука о заполнении формы">
  {`{
    "type": "view",
    "event": "submit",
    "private_metadata": "{'timeoff_id':4378}",
    "callback_id": "timeoff_reguest_form",
    "user_id": 1235523,
    "data": {
        "date_start": "2025-07-01",
        "date_end": "2025-07-14",
        "request_doc": [
            {
                "name": "request.png",
                "size": 19153,
                "url": "<url>"
            }
        ],
        "accessibility": "phone_only",
        "info": "Поеду в сибирь на свадьбу лучшего друга",
        "newsletters": ["new_tasks", "project_updates"],
        "team": "success",
        "time": "22:00"
    },
    "webhook_timestamp": 1755075544
}`}
</CodeBlock>

<Warning>Срок жизни прямых ссылкок на скачивание файлов ограничен и составляет **1 час**</Warning>

## Закрытие и отображение ошибок

После заполнения пользователем полей в представлении в приложение будет отправлен исходящий вебхук. В этот момент вы можете сохранить полученные значения или провести валидацию правильности заполнения полей и отправить пользователю ошибки.

Вам необходимо оперативно ответить на вебхук (кодом `200` или `400` со списком ошибок). В ином случае, пользователь получит ошибку отправки в интерфейсе Пачки. Все значения полей будут сохранены и **пользователь повторит попытку отправки формы**.

<Danger>
  С целью поддержания интерактивности и отзывчивости интерфейсов Пачки, время на ответ ограничего.
  Ваше приложение должно дать ответ на вебхук в течение **3 секунд**.
</Danger>

### Отображение ошибок

Если вы хотите отобразить пользователю ошибки заполнения конкретных полей представления, то ответ должен быть `HTTP 400 Bad Request`, а тело ответа содержать массив полей с указанием текста ошибки.

<SchemaBlock
  name="ViewErrorsResponse"
  title="Тело ответа с указанием текста ошибки для каждого поля"
/>

<CodeBlock language="http" title="Пример ответа на вебхук для отображения ошибок">
{`HTTP/1.1 400 Bad Request
Server: nginx/1.14.2
Date: Wed, 22 Apr 2025 12:32:29 GMT
Content-Type: application/json; charset=utf-8
Transfer-Encoding: chunked
Connection: close
ETag: W/"4d63aae1430a3bbd35e95e3db6b364df"
Cache-Control: max-age=0, private, must-revalidate
X-Request-Id: 12f8a05c-c5cf-4a79-8d2f-f82cc477c410
X-Runtime: 0.117503
Vary: Origin
X-Rack-CORS: miss; no-origin

{
    "errors": {
        "date_end": "Дата окончания отпуска не может быть меньше даты начала",
        "request_doc": "В заявлении не найдена электронная подпись"
    }
}`}

</CodeBlock>

<ImageCard src="/images/forms/errors.png" alt="Пример отображения ошибок в интерфейсе представления" caption="Пример отображения ошибок в интерфейсе представления" maxWidth={810} />

### Закрытие представления

Если вы хотите просто закрыть пользователю представление (нет необходимости отображать ошибки), то ответ должен быть `HTTP 200 OK`. Никакое тело ответа не требуется.

<CodeBlock language="http" title="Пример ответа на вебхук для закрытия представления">
  {`HTTP/1.1 200 OK
Server: nginx/1.14.2
Date: Wed, 22 Apr 2025 12:32:29 GMT
Content-Type: text/plain; charset=utf-8`}
</CodeBlock>
