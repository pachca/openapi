---
title: Исходящий Webhook
description: Получение уведомлений о событиях в реальном времени
---

# Исходящий Webhook

Исходящие вебхуки позволяют вам получать информацию о событиях в вашем пространстве в реальном времени. Это могут быть новые сообщения, реакции, чаты, участники и тд.

Вебхук представляет собой `JSON` объект, отправляемый в момент наступления события на указанный в настройках бота `URL`, содержащий небольшое количество информации, которой достаточно для написания автоматизаций. Если требуется получить больше информации об объектах, указанных в `JSON` - вы можете воспользоваться `API` и получить полную информацию.

Каждый исходящий вебхук защищён с помощью подписи, основанной на хешировании содержимого. Подробнее об этом, а также о других методах проверки подлинности исходящего вебхука, вы можете прочитать в блоке [Безопасность](#безопасность).

## Как получать Webhook

Все настройки исходящих вебхуков находятся в чат-ботах. Создавая нового бота, вы получаете возможность указать `Webhook URL` и выбрать те события, которые вы хотите получать.

Большинство типов событий потребуют добавления бота в чаты. Именно по этим чатам и по отправленным ботом сообщениям вы будете получать события. Есть глобальные события (например, Изменение состава участников пространства), которые не требуют добавления бота в чат.

<Tip>
  О том, как создать бота и добавить его в чаты, вы можете прочитать в статье
  [Чат-боты через Webhook/API](https://www.pachca.com/articles/webhook)
</Tip>

## Новые сообщения

Данный вебхук отправляется при появлении нового сообщения в чате, где участвует бот.

Вы можете получать как все новые сообщения в чате, так и только те, которые начинаются с указанных команд. Это будет полезно, если вы не хотите получать поток событий, а вам нужно только по требованию пользователя вызвать какой-то сценарий.

<SchemaBlock name="MessageWebhookPayload" />

## Добавление и удаление реакций

Данный вебхук отправляется при добавлении или удалении реакции на сообщение в чате, где участвует бот.

<SchemaBlock name="ReactionWebhookPayload" />

## Нажатие кнопок

Данный вебхук отправляется при нажатии `Data-кнопки` в сообщении от бота. После получения этого вебхука вы можете воспользоваться методом [Редактирование сообщения](PUT /messages/{id}) и изменить/удалить кнопки у сообщения или отправить [Новое сообщение](POST /messages) как реакцию пользователю.

Подробнее о работе с кнопками в ботах вы можете прочитать в статье [Кнопки в чат-ботах](https://www.pachca.com/articles/knopki-v-chat-botah)

<SchemaBlock name="ButtonWebhookPayload" />

## Изменение состава участников чатов

Данный вебхук отправляется при изменении состава участников чатов, где состоит бот, и в тредах этих чатов.

<SchemaBlock name="ChatMemberWebhookPayload" />

## Изменение состава участников пространства

Данный вебхук отправляется при изменении состава участников пространства, включая изменение состояния участников (смотреть на значение поля event).

<SchemaBlock name="CompanyMemberWebhookPayload" />

## Безопасность

Каждый исходящий вебхук защищён с помощью подписи, основанной на хешировании содержимого. Подпись `HMAC` с использованием алгоритма `SHA256` вычисляется из тела запроса и передаётся в заголовке `Pachca-Signature`.

В теле вебхука также содержится поле `webhook_timestamp` — метка времени в формате UNIX, указывающая момент отправки вебхука. Рекомендуется проверять, что это значение находится в пределах одной минуты от времени получения запроса, чтобы предотвратить атаки повторной отправки (replay attacks).

<CodeBlock language="http" title="Пример исходящего вебхука (новое сообщение)">
{`POST https://yourweb.site/read HTTP/1.1
host: yourweb.site
content-Type: application/json
pachca-signature: a805d3470c263f4628cafc4ed66235d8fe2229891d1fcf4e400331adff5d8e5a
user-agent: Faraday v2.12.2
content-length: 358

{
    "event": "new",
    "type": "message",
    "webhook_timestamp": 1744618734,
    "chat_id": 918264,
    "content": "Клиент просит поправить шапку, подробности в документе",
    "user_id": 134412,
    "id": 56431,
    "created_at": "2025-04-14T08:18:54.000Z",
    "parent_message_id": null,
    "entity_type": "discussion",
    "entity_id": 918264,
    "thread": null,
    "url": "https://app.pachca.com/chats/124511?message=56431"
}`}

</CodeBlock>

Для проверки подписи необходимо вычислить её самостоятельно, используя секрет вебхука `Signing secret`, который доступен в настройках бота во вкладке «Исходящий webhook». Рекомендуется использовать сырой (raw) контент тела запроса для вычисления хеша, так как при JSON-парсинге содержимое может быть изменено.

<CodeBlock language="javascript" title="Вычисление и сравнение подписи">
{`// WEBHOOK_SECRET - значение поля Signing secret во вкладке «Исходящий webhook» в настройках бота

const signature = crypto.createHmac("sha256", WEBHOOK_SECRET).update(rawBody).digest("hex");
if (signature !== request.headers['pachca-signature']) {
    throw "Invalid signature"
}`}

</CodeBlock>

Кроме проверки подписи, также рекомендуется валидировать IP-адреса отправителя.

IP-адрес Пачки: `37.200.70.177`
