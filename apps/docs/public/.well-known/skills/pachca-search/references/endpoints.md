# pachca-search — Справочник эндпоинтов

## Поиск чатов

**GET** `/search/chats`

> Скоуп: `search:chats`

Поиск чатов

Метод для полнотекстового поиска каналов и бесед.

**Параметры:**

- `query` (query, string, опциональный): Текст поискового запроса
- `limit` (query, integer, опциональный): Количество возвращаемых результатов за один запрос
- `cursor` (query, string, опциональный): Курсор для пагинации (из meta.paginate.next_page)
- `order` (query, string, опциональный): Направление сортировки
  - Значения: `asc`, `desc`
- `created_from` (query, string, опциональный): Фильтр по дате создания (от)
- `created_to` (query, string, опциональный): Фильтр по дате создания (до)
- `active` (query, boolean, опциональный): Фильтр по активности чата (true — активные, false — архивированные)
- `chat_subtype` (query, string, опциональный): Фильтр по типу чата
  - Значения: `discussion`, `thread`
- `personal` (query, boolean, опциональный): Фильтр по личным чатам (true — только личные)

**Пример:**

```bash
curl "https://api.pachca.com/api/shared/v1/search/chats?query=%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B0&limit=100&cursor=string&order=asc&created_from=2024-04-08T10%3A00%3A00.000Z&created_to=2024-04-08T10%3A00%3A00.000Z&active=true&chat_subtype=discussion&personal=true" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

**Ответ:**

- `data` (array[object], **обязательный**): 
  - `id` (integer, **обязательный**): Идентификатор созданного чата
  - `name` (string, **обязательный**): Название
  - `created_at` (string, **обязательный**): Дата и время создания чата (ISO-8601, UTC+0) в формате YYYY-MM-DDThh:mm:ss.sssZ
  - `owner_id` (integer, **обязательный**): Идентификатор пользователя, создавшего чат
  - `member_ids` (array[integer], **обязательный**): Массив идентификаторов пользователей, участников
  - `group_tag_ids` (array[integer], **обязательный**): Массив идентификаторов тегов, участников
  - `channel` (boolean, **обязательный**): Является каналом
  - `personal` (boolean, **обязательный**): Является личным чатом
  - `public` (boolean, **обязательный**): Открытый доступ
  - `last_message_at` (string, **обязательный**): Дата и время создания последнего сообщения в чате (ISO-8601, UTC+0) в формате YYYY-MM-DDThh:mm:ss.sssZ
  - `meet_room_url` (string, **обязательный**): Ссылка на Видеочат
- `meta` (object, **обязательный**): Мета-информация для пагинации поисковых результатов
  - `total` (integer, **обязательный**): Общее количество найденных результатов
  - `paginate` (object, **обязательный**): Вспомогательная информация
    - `next_page` (string, **обязательный**): Курсор пагинации следующей страницы

---

## Поиск сообщений

**GET** `/search/messages`

> Скоуп: `search:messages`

Поиск сообщений

Метод для полнотекстового поиска сообщений.

**Параметры:**

- `query` (query, string, опциональный): Текст поискового запроса
- `limit` (query, integer, опциональный): Количество возвращаемых результатов за один запрос
- `cursor` (query, string, опциональный): Курсор для пагинации (из meta.paginate.next_page)
- `order` (query, string, опциональный): Направление сортировки
  - Значения: `asc`, `desc`
- `created_from` (query, string, опциональный): Фильтр по дате создания (от)
- `created_to` (query, string, опциональный): Фильтр по дате создания (до)
- `chat_ids` (query, array, опциональный): Фильтр по ID чатов
- `user_ids` (query, array, опциональный): Фильтр по ID авторов сообщений
- `active` (query, boolean, опциональный): Фильтр по активности чата (true — активные чаты, false — архивированные)

**Пример:**

```bash
curl "https://api.pachca.com/api/shared/v1/search/messages?query=%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B0&limit=200&cursor=string&order=asc&created_from=2024-04-08T10%3A00%3A00.000Z&created_to=2024-04-08T10%3A00%3A00.000Z&chat_ids[]=100&user_ids[]=100&active=true" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

**Ответ:**

- `data` (array[object], **обязательный**): 
  - `id` (integer, **обязательный**): Идентификатор сообщения
  - `entity_type` (object, **обязательный**): Тип сущности, к которой относится сообщение
  - `entity_id` (integer, **обязательный**): Идентификатор сущности, к которой относится сообщение (беседы/канала, треда или пользователя)
  - `chat_id` (integer, **обязательный**): Идентификатор чата, в котором находится сообщение
  - `root_chat_id` (integer, **обязательный**): Идентификатор корневого чата. Для сообщений в тредах — идентификатор чата, в котором был создан тред. Для обычных сообщений совпадает с `chat_id`.
  - `content` (string, **обязательный**): Текст сообщения
  - `user_id` (integer, **обязательный**): Идентификатор пользователя, создавшего сообщение
  - `created_at` (string, **обязательный**): Дата и время создания сообщения (ISO-8601, UTC+0) в формате YYYY-MM-DDThh:mm:ss.sssZ
  - `url` (string, **обязательный**): Прямая ссылка на сообщение
  - `files` (array[object], **обязательный**): Прикрепленные файлы
    - `id` (integer, **обязательный**): Идентификатор файла
    - `key` (string, **обязательный**): Путь к файлу
    - `name` (string, **обязательный**): Название файла с расширением
    - `file_type` (object, **обязательный**): Тип файла
    - `url` (string, **обязательный**): Прямая ссылка на скачивание файла
    - `width` (integer, опциональный): Ширина изображения в пикселях
    - `height` (integer, опциональный): Высота изображения в пикселях
  - `buttons` (array[array], **обязательный**): Массив строк, каждая из которых представлена массивом кнопок
  - `thread` (object, **обязательный**): Тред сообщения
  - `forwarding` (object, **обязательный**): Информация о пересланном сообщении
  - `parent_message_id` (integer, **обязательный**): Идентификатор сообщения, к которому написан ответ
  - `display_avatar_url` (string, **обязательный**): Ссылка на аватарку отправителя сообщения
  - `display_name` (string, **обязательный**): Полное имя отправителя сообщения
  - `changed_at` (string, **обязательный**): Дата и время последнего редактирования сообщения (ISO-8601, UTC+0) в формате YYYY-MM-DDThh:mm:ss.sssZ
  - `deleted_at` (string, **обязательный**): Дата и время удаления сообщения (ISO-8601, UTC+0) в формате YYYY-MM-DDThh:mm:ss.sssZ
- `meta` (object, **обязательный**): Мета-информация для пагинации поисковых результатов
  - `total` (integer, **обязательный**): Общее количество найденных результатов
  - `paginate` (object, **обязательный**): Вспомогательная информация
    - `next_page` (string, **обязательный**): Курсор пагинации следующей страницы

---

## Поиск сотрудников

**GET** `/search/users`

> Скоуп: `search:users`

Поиск сотрудников

Метод для полнотекстового поиска сотрудников по имени, email, должности и другим полям.

**Параметры:**

- `query` (query, string, опциональный): Текст поискового запроса
- `limit` (query, integer, опциональный): Количество возвращаемых результатов за один запрос
- `cursor` (query, string, опциональный): Курсор для пагинации (из meta.paginate.next_page)
- `sort` (query, string, опциональный): Сортировка результатов
  - Значения: `by_score`, `alphabetical`
- `order` (query, string, опциональный): Направление сортировки
  - Значения: `asc`, `desc`
- `created_from` (query, string, опциональный): Фильтр по дате создания (от)
- `created_to` (query, string, опциональный): Фильтр по дате создания (до)
- `company_roles` (query, array, опциональный): Фильтр по ролям сотрудников

**Пример:**

```bash
curl "https://api.pachca.com/api/shared/v1/search/users?query=%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B0&limit=200&cursor=string&sort=by_score&order=asc&created_from=2024-04-08T10%3A00%3A00.000Z&created_to=2024-04-08T10%3A00%3A00.000Z&company_roles[]=admin" \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

**Ответ:**

- `data` (array[object], **обязательный**): 
  - `id` (integer, **обязательный**): Идентификатор пользователя
  - `first_name` (string, **обязательный**): Имя
  - `last_name` (string, **обязательный**): Фамилия
  - `nickname` (string, **обязательный**): Имя пользователя
  - `email` (string, **обязательный**): Электронная почта
  - `phone_number` (string, **обязательный**): Телефон
  - `department` (string, **обязательный**): Департамент
  - `title` (string, **обязательный**): Должность
  - `role` (object, **обязательный**): Уровень доступа
  - `suspended` (boolean, **обязательный**): Деактивация пользователя
  - `invite_status` (object, **обязательный**): Статус приглашения
  - `list_tags` (array[string], **обязательный**): Массив тегов, привязанных к сотруднику
  - `custom_properties` (array[object], **обязательный**): Дополнительные поля сотрудника
    - `id` (integer, **обязательный**): Идентификатор поля
    - `name` (string, **обязательный**): Название поля
    - `data_type` (object, **обязательный**): Тип поля
    - `value` (string, **обязательный**): Значение
  - `user_status` (object, **обязательный**): Статус
  - `bot` (boolean, **обязательный**): Является ботом
  - `sso` (boolean, **обязательный**): Использует ли пользователь SSO
  - `created_at` (string, **обязательный**): Дата создания (ISO-8601, UTC+0) в формате YYYY-MM-DDThh:mm:ss.sssZ
  - `last_activity_at` (string, **обязательный**): Дата последней активности пользователя (ISO-8601, UTC+0) в формате YYYY-MM-DDThh:mm:ss.sssZ
  - `time_zone` (string, **обязательный**): Часовой пояс пользователя
  - `image_url` (string, **обязательный**): Ссылка на скачивание аватарки пользователя
- `meta` (object, **обязательный**): Мета-информация для пагинации поисковых результатов
  - `total` (integer, **обязательный**): Общее количество найденных результатов
  - `paginate` (object, **обязательный**): Вспомогательная информация
    - `next_page` (string, **обязательный**): Курсор пагинации следующей страницы

---
