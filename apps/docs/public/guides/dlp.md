
# DLP-система

#corporation_price_only

Встроенная в Пачку DLP-система (Data Loss Prevention) позволяет вам построить защиту от утечек конфиденциальной информации без интеграции сторонних сервисов.

Управление правилами DLP-системы доступно в разделе «Настройки пространства» → «DLP». Вы можете изменять список правил, а также включать и отключать их.

<ImageCard src="/images/dlp/dlp-page.png" alt="Список правил DLP-системы" caption="Список правил DLP-системы" />

## Создание правила

Чтобы внести новое правило нажмите на кнопку «Создать новое правило», укажите название правила (чтобы было проще его потом изменить или удалить), его приоритет и `JSON` объект условия.

<ImageCard src="/images/dlp/new-rule.png" alt="Новое правило" caption="Создание нового правила" maxWidth={500} />

Параметр «Приоритет» задает значение приоритета для политики, определяющее порядок её обработки. Меньшее целое число указывает на более высокий приоритет, значение 0 — на наивысший приоритет. Правила не могут иметь одинаковое значение приоритета.

`JSON` условие состоит из трёх полей: контекст применения правила (необязательное), условие срабатывания правила и действие при срабатывании правила. Параметры и пример условия вы можете посмотреть ниже.

## Структура правила

#### DlpRule

- `scope` (object, опциональный): Объект контекста применения правила
  - `to_external` (boolean, опциональный): Применимость правила к внешним контактам. При значении true правило работает только при наличии гостей или мульти-гостей в чате.
    - По умолчанию: `false`
  - `channel_type` (array[string], опциональный): Массив типов чата, для которых будет работать правило
  - `user_role` (array[string], опциональный): Массив ролей пользователя в чате, для которых будет работать правило
- `conditions` (object, **обязательный**): Объект условия срабатывания правила. Можно указать all, any или оба.
  - `all` (array[object], опциональный): Массив условий (все должны совпасть)
    - `type` (string, **обязательный**): Тип условия
      - **Возможные значения:**
        - `regex`: регулярное выражение
        - `keyword`: ключевое слово
    - `max_hits` (integer, опциональный): Максимальное количество совпадений
    - `min_hits` (integer, опциональный): Минимальное количество совпадений
      - По умолчанию: `1`
    - `pattern` (string, опциональный): Регулярное выражение для поиска в тексте. Используется синтаксис [Google RE2](https://github.com/google/re2/wiki/Syntax). Обязательно, если type указано как regex.
    - `value` (string, опциональный): Ключевое слово для поиска в тексте. Обязательно, если type указано как keyword.
  - `any` (array[object], опциональный): Массив условий (хотя бы одно должно совпасть)
    - `type` (string, **обязательный**): Тип условия
      - **Возможные значения:**
        - `regex`: регулярное выражение
        - `keyword`: ключевое слово
    - `max_hits` (integer, опциональный): Максимальное количество совпадений
    - `min_hits` (integer, опциональный): Минимальное количество совпадений
      - По умолчанию: `1`
    - `pattern` (string, опциональный): Регулярное выражение для поиска в тексте. Используется синтаксис [Google RE2](https://github.com/google/re2/wiki/Syntax). Обязательно, если type указано как regex.
    - `value` (string, опциональный): Ключевое слово для поиска в тексте. Обязательно, если type указано как keyword.
- `action` (object, **обязательный**): Объект действия при срабатывании правила
  - `type` (string, **обязательный**): Тип действия
    - **Возможные значения:**
      - `BLOCK`: удалить текст сообщения
      - `AUDIT_LOG`: добавить запись в журнал событий
  - `message` (string, опциональный): Текст сообщения для пользователя


**Пример правила #1**

```json
{`{
    "conditions": {
        "any": [
            {
                "type": "regex",
                "pattern": "\\\\b(?:\\\\+7|7|8)\\\\s*\\\\(?\\\\d{3}\\\\)?\\\\s*\\\\d{3}[\\\\s-]*\\\\d{2}[\\\\s-]*\\\\d{2}\\\\b"
            }
        ]
    },
    "action": {
        "type": "AUDIT_LOG",
        "message": "Обнаружен номер телефона в сообщении"
    }
}`}
```


**Пример правила #2**

```json
{`{
    "conditions": {
        "all": [
            {
                "type": "keyword",
                "value": "паспорт"
            },
            {
                "type": "regex",
                "pattern": "\\\\b\\\\d{4}\\\\s?\\\\d{6}\\\\b"
            }
        ]
    },
    "action": {
        "type": "BLOCK",
        "message": "Нельзя отправлять паспортные данные"
    }
}`}
```

