
# Экспорт сообщений

#corporation_price_only #owner_access_token_required

Экспорт сообщений — это архив c файлами в формате `JSON`, где собраны все сообщения из всех чатов, которые были созданы в вашем пространстве.

В экспорте вам будут доступны все сообщения из открытых, закрытых и архивных чатов, в том числе треды. У каждого сообщения будет указан автор, время отправки, текст, список реакций на это сообщение.

Так же, в экспорте есть личные переписки, но в ограниченном формате. В них указан автор сообщения, время отправки, но нет контента сообщений и тредов. Эти данные полезны для оценки вовлеченность сотрудников их активности или оценке нагрузки на каждого из членов команды.

На основе выгрузки можно замерять количество сообщений и реакций в общих чатах. Так можно рассчитать Engagment Rate и улучшать корп. культуру/коммуникацию среди сотрудников. Ещё можно подсчитывать количество активных чатов и смотреть, насколько много в компании ведется обсуждений.

## Как это работает


  ### Шаг 1. Запросите экспорт

При запросе экспорта можно настроить период, за который вы хотите получить данные, но не более 45 дней. И можете добавить ID-чатов, из которых вы хотите получить экспорт. Если вам нужны данные за период дольше 45 дней, то по завершении одной выгрузки, можно запросить следующую с новым диапазоном дат.

    При запросе экспорта важно учитывать следующие ограничения:

    - выгружаются все чаты, в том числе архивные и личные без контента сообщений
    - не выгружаются треды в личных сообщениях
    - не учитываются вложения
    - не отражаются пересланные сообщения
    - максимальный период одной выгрузки: 45 дней (при запросе с указанием конкретных чатов - 366 дней)
    - максимальный количество запрашиваемых чатов (при указании): 50
    - новый запрос на экспорта вы сможете сделать после завершения текущего

    Для запроса экспорта используйте метод [Экспорт сообщений](POST /chats/exports).

    Экспорт выполняется асинхронно. На указанный `webhook_url` будет отправлен `JSON` с информацией о готовом экспорте.

    **Пример JSON вебхука об успешном завершении экспорта**

```json
{
    "type": "export",
    "event": "ready",
    "export_id": 22322,
    "created_at": "2025-03-20T12:33:58Z"
}
```


  ### Шаг 2. Скачайте готовый архив

Получив `JSON` с информацией о готовом экспорте, вам необходимо взять значение поля `export_id` и выполнить запрос на скачивание архива сообщений, указав его в `URL` запроса.

    Для скачивания архива используйте метод [Скачать архив экспорта](GET /chats/exports/{id}).


  ### Шаг 3. Изучите структуру архива

Архив представляет собой папки, где каждая папка соответствует чату в вашем пространстве. Название папки состоит из имени чата и его `ID`, например: `Design_12925828`. Внутри папки будут `JSON`-файлы, которые соответствуют дате переписки. Каждый день — отдельный файл.

    Дополнительно, рядом с папками будет находиться список чатов, которые попали в экспорт. Список чатов представлен файлом `chats.json`. Список не создается, если при запросе экспорта было указано `skip_chats_file` как `true`.

    ```
├── Design_12925828/
│   ├── 2025-01-15.json
│   ├── 2025-01-16.json
│   └── 2025-01-17.json
├── Marketing_12925901/
│   ├── 2025-01-15.json
│   └── 2025-01-16.json
├── Development_12926012/
│   ├── 2025-01-15.json
│   ├── 2025-01-16.json
│   └── 2025-01-17.json
└── chats.json
```


    #### Структура данных в JSON-файлах сообщений

- `id` (integer, опциональный): Идентификатор сообщения
- `created_at` (string, date-time, опциональный): Дата и время создания сообщения (ISO-8601, UTC+0)
- `deleted_at` (string, date-time, опциональный): Дата и время удаления сообщения. Возвращается как null, если сообщение не удалено.
- `content` (string, опциональный): Текст сообщения
- `thread_id` (integer, опциональный): Идентификатор треда сообщения. Возвращается как null, если у сообщения нет комментариев.
- `reactions` (array[object], опциональный): Массив списка реакций
  - `user_id` (integer, опциональный): Идентификатор пользователя, который добавил реакцию
  - `created_at` (string, опциональный): Дата и время добавления реакции (ISO-8601, UTC+0)
  - `code` (string, опциональный): Emoji символ реакции
- `user` (object, опциональный): Информация об авторе сообщения
  - `id` (integer, опциональный): Идентификатор пользователя
  - `role` (string, опциональный): Тип автора
    - **Возможные значения:**
      - `member`: пользователь
      - `bot`: бот
  - `name` (string, опциональный): Имя
  - `last_name` (string, опциональный): Фамилия
  - `email` (string, опциональный): Электронная почта
  - `tags` (array[string], опциональный): Массив тегов, привязанных к пользователю
- `chat` (object, опциональный): Информация о чате, в котором было написано сообщение
  - `id` (integer, опциональный): Идентификатор чата
  - `name` (string, опциональный): Название чата
  - `personal` (boolean, опциональный): Тип чата
    - **Возможные значения:**
      - `true`: личный чат
      - `false`: групповой чат
  - `owner` (object, опциональный): Информация о владельце чата
    - `id` (integer, опциональный): Идентификатор пользователя
    - `role` (string, опциональный): Тип владельца
      - **Возможные значения:**
        - `member`: пользователь
        - `bot`: бот
    - `name` (string, опциональный): Имя
    - `last_name` (string, опциональный): Фамилия
    - `email` (string, опциональный): Электронная почта
    - `tags` (array[string], опциональный): Массив тегов
  - `tags` (array[string], опциональный): Массив тегов, привязанных к чату
- `thread` (object, опциональный): Тред, в котором находится сообщение. Возвращается как null, если сообщение находится не в треде.
  - `id` (integer, опциональный): Идентификатор треда
  - `message_id` (integer, опциональный): Идентификатор сообщения, под которым был начат тред
  - `message_chat_id` (string, опциональный): Идентификатор чата, в котором был начат тред


    Список в файле `chats.json` представляет собой массив объектов чатов. Структура каждого объекта чата описана ниже.

    #### Структура объекта чата в массиве файла chats.json

- `id` (integer, опциональный): Идентификатор чата
- `personal` (boolean, опциональный): Тип чата
  - **Возможные значения:**
    - `true`: личный чат
    - `false`: групповой чат
- `name` (string, опциональный): Название
- `owner_id` (integer, опциональный): Идентификатор пользователя, создавшего чат
- `members` (array[object], опциональный): Массив объектов участников чата
  - `id` (integer, опциональный): Идентификатор пользователя
  - `role` (string, опциональный): Роль в чате
    - **Возможные значения:**
      - `owner`: создатель
      - `admin`: админ
      - `editor`: редактор
      - `member`: участник/подписчик
- `created_at` (string, date-time, опциональный): Дата и время создания чата (ISO-8601, UTC+0)
- `updated_at` (string, date-time, опциональный): Дата и время обновления чата (ISO-8601, UTC+0)


