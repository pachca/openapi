---
name: pachca-forms
description: >
  Интерактивные формы с полями ввода и кнопками для ботов. Используй когда нужно:
  показать форму, обработать submit формы, создать модальное окно. НЕ используй
  для: обычных кнопок в сообщениях (→ pachca-messages), настройки бота (→
  pachca-bots).
---

# Интерактивные формы

Base URL: `https://api.pachca.com/api/shared/v1`
Авторизация: `Authorization: Bearer <ACCESS_TOKEN>`
Токен: **только бот** (Автоматизации → Интеграции → API). Пользовательский токен не подойдёт — формы требуют исходящий вебхук.

## Когда использовать

- показать форму
- интерактивная форма
- модальное окно
- modal
- view
- submit формы

## Когда НЕ использовать

- получить профиль, обновить статус, мой профиль → **pachca-profile**
- найти сотрудника, создать пользователя, список сотрудников → **pachca-users**
- создать канал, создать беседу, создать чат → **pachca-chats**
- отправить сообщение, ответить в тред, прикрепить файл → **pachca-messages**
- настроить бота, вебхук, webhook → **pachca-bots**
- создать задачу, список задач, напоминание → **pachca-tasks**
- аудит, журнал событий, безопасность → **pachca-security**

## Пошаговые сценарии

### Показать интерактивную форму пользователю

1. Заранее подготовь объект формы (view с title и blocks) — собери его ДО получения trigger_id
2. Отправь сообщение с кнопкой (POST /messages с buttons, в data кнопки передай идентификатор формы)
3. При нажатии кнопки — получи вебхук-событие с trigger_id
4. Немедленно отправь POST /views/open с trigger_id и готовым объектом формы
5. Пользователь заполняет форму → результат приходит на Webhook URL

> trigger_id живёт 3 секунды — за это время нужно успеть отправить POST /views/open. Формируй объект формы заранее, а не после получения события. Формы работают только от бота (GET /profile → data.bot === true).

### Опрос сотрудников через форму

1. Отправь сообщение с кнопкой «Пройти опрос» в канал или ЛС: POST /messages с buttons[0][0].data = "survey_start"
2. При нажатии кнопки получи вебхук с trigger_id и user_id нажавшего
3. Немедленно отправь POST /views/open с формой (поля: text_field, select и т.д.)
4. При отправке формы получи вебхук с результатами (поле values в payload)
5. Обработай ответы: сохрани в базу или отправь итоговым сообщением в канал

> Каждый пользователь должен нажать кнопку сам — у каждого свой trigger_id. Нельзя открыть форму принудительно.

### Форма заявки/запроса

1. Размести в канале сообщение с кнопкой «Создать заявку» (data: "new_request")
2. При нажатии открой форму с полями: тема, описание, приоритет (select)
3. При submit-вебхуке: создай задачу (POST /tasks) или отправь уведомление ответственному (POST /messages с entity_type: "user")
4. Отправь подтверждение автору: POST /messages с entity_type: "user", entity_id: user_id из вебхука

## Обработка ошибок

| Код | Причина | Что делать |
|-----|---------|------------|
| 422 | Неверные параметры | Проверь обязательные поля, типы данных, допустимые значения enum |
| 429 | Rate limit | Подожди и повтори. Лимит: ~50 req/sec, сообщения ~4 req/sec |
| 403 | Нет доступа | Бот не в чате, или endpoint только для админов/владельцев |
| 404 | Не найдено | Неверный id. Проверь что сущность существует |
| 401 | Не авторизован | Проверь токен в заголовке Authorization |
| 410 | trigger_id истёк или не найден | trigger_id действует 3 секунды. Получи новый через нажатие кнопки (вебхук) |

## Доступные операции

### Открытие представления

`POST /views/open`

```json
{
  "type": "modal",
  "trigger_id": "",
  "view": {
    "title": "",
    "blocks": []
  }
}
```

## Ограничения и gotchas

- `type`: допустимые значения — `modal`
- `private_metadata`: максимум 3000 символов
- `callback_id`: максимум 255 символов
- `view.title`: максимум 24 символов
- `view.close_text`: максимум 24 символов
- `view.submit_text`: максимум 24 символов
- Пагинация: cursor-based (limit + cursor), НЕ page-based

## Подробнее

см. [references/endpoints.md](references/endpoints.md)
